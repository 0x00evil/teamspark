<template name="sparks">
  {{>sparkFilter}}
  {{>sparkInput}}
  <div class="sparks">
    {{#each sparks}}
    {{>spark}}
    {{/each}}
  </div>
</template>

<template name="sparkFilter">
  <div class="navbar spark-controls">
    <div class="navbar-inner">
      <div class="container">
        <div class="nav-collapse collapse">
          <ul class="nav spark-list">
            {{#each types}}
            <li data-id="{{id}}" data-name="{{name}}"><a href="#"><i class="{{icon}}"></i>{{name}}</a></li>
            {{/each}}
          </ul>
          <ul class="nav pull-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-user"></i>作者 <b class="caret"></b></a>
              <ul class="dropdown-menu" id="filter-spark-author">
                <li data-id="" data-name=""><a href="#"><i class="{{isAuthorSelected all}}"></i> 全部</a></li>
                {{#each ts.members}}
                <li data-id="{{_id}}" data-name="{{username}}"><a href="#"><i class="{{isAuthorSelected _id}}"></i> {{username}}</a></li>
                {{/each}}
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-user"></i>责任人 <b class="caret"></b></a>
              <ul class="dropdown-menu" id="filter-spark-owner">
                <li data-id="" data-name=""><a href="#"><i class="{{isOwnerSelected all}}"></i>全部</a></li>
                {{#each ts.members}}
                <li data-id="{{_id}}" data-name="{{username}}"><a href="#"><i class="{{isOwnerSelected _id}}"></i>{{username}}</a></li>
                {{/each}}
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-list-ul"></i> <b class="caret"></b></a>
              <ul class="dropdown-menu" id="filter-spark-type">
                <li data-id="all" data-name=""><a href="#"><i class="{{isTypeSelected all}}"></i>全部</a></li>
                {{#each types}}
                <li data-id="{{id}}" data-name="{{name}}"><a href="#"><i class="{{isTypeSelected id}}"></i>{{name}}</a></li>
                {{/each}}
              </ul>
            </li>
            <li><a><input type="checkbox" id="hide-finished" checked="{{hideFinished}}" /> 隐藏已完成</a></li>

          </ul>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="spark">
  <div class="spark">
    <div class="avatar">
      <img class="avatar" src="{{author.avatar}}" alt="{{author.username}}" title="{{author.username}}" />
      <p><i class="{{typeObj.icon}} {{urgentStyle}} {{importantStyle}}" title="{{info}}"></i></p>
    </div>
    <div class="spark-container">
      <div class="title">
        <h5>
          <a href="#">{{author.username}}</a> 分享了一个{{typeObj.name}}
          <ul class="pull-right nav">
            <li class="support {{supported}}"><a href="#" title="支持"><i class="icon-thumbs-up"></i></a></li>
            <li class="upload"><a href="#" title="上传文件"><i class="icon-upload"></i></a></li>
            <li class="edit"><a href="#" title="编辑"><i class="icon-edit"></i></a></li>
            {{#if canFinish}}
            <li class="finish"><a href="#" title="完成"><i class="icon-ok"></i></a></li>
            {{/if}}
          </ul>
        </h5>
        <p>
          <span>{{created}}</span> |
          <span>{{project.name}}</span> |
          <span>最后更新: {{updated}}</span>
        </p>
      </div>
      <div class="content">
        <div class="modal-header">
          <h4>
            {{title}}
            <div class="pull-right">
            {{#if supporters}}
            <span class="small">支持者:</span> <ul>{{{showSupporters}}}</ul>
            {{/if}}
            </div>
          </h4>
        </div>
        <div class="modal-body">
          <p>{{{content}}}</p>
          {{#if hasImages}}
          <hr/>
          <p>共{{images.length}}张图片：</p>
          <div class="carousel slide" id="{{_id}}">
            <div class="carousel-inner" data-interval="false" >
              {{#each images}}
              <div class="item">
                <img src="{{url}}" alt="{{filename}}" />
                <div class="carousel-caption">
                  <p>文件大小: {{size}}字节 | 下载: <a href="{{url}}">{{filename}}</a></p>
                </div>
              </div>
              {{/each}}
            </div>
            <a class="left carousel-control" href="#{{_id}}" data-slide="prev">‹</a>
            <a class="right carousel-control" href="#{{_id}}" data-slide="next">›</a>
          </div>
          {{/if}}

          {{#if hasFiles}}
          <hr/>
          <p>共{{files.length}}个文件：</p>
          <ul class="files">
            {{#each files}}
            <li><a href="{{url}}"><i class="icon-file"></i>{{filename}}</a><span class="small insignificant"> ({{size}}字节)</span></li>
            {{/each}}
          </ul>
          {{/if}}
        </div>
        <div class="modal-footer">
          <ul class="nav pull-left owners">
            {{#if currentOwner}}
              分配给：<ul>{{{showOwners}}}</ul>
            {{else}}
              <li><a href="#"><i class="icon-tasks"></i>分配</a></li>
            {{/if}}
          </ul>
          <ul class="nav pull-right">
            <li class="show-comments"><a href="#"><i class="icon-comments-alt"></i>讨论</a></li>
            <li class="show-audits"><a href="#"><i class="icon-book"></i>历史</a></li>
          </ul>
        </div>
        <div class="comment-box hide comments">
          {{>commentInput}}
          <ul class="comment-list">
          {{#each reversedComments}}
            {{>comment}}
          {{/each}}
          </ul>
        </div>
        <div class="comment-box hide audits">
          <ul class="comment-list audit-list">
            {{#each reversedAudits}}
            {{>comment}}
            {{/each}}
          </ul>
        </div>
      </div>
    </div>

  </div>
</template>

<template name="commentInput">
  <form id="create-comment-form" class="form-horizontal">
    <div class="control-group">
      <img src="{{avatar}}" class="avatar-medium">
      <div class="controls">
        <input type="hidden" name="spark-id" value="{{_id}}" />
        <textarea id="id-content" name="content" rows="1" placeholder="分享一下你的想法"></textarea>
        <button type="button" class="btn btn-green">发表</button>
      </div>
    </div>
  </form>
</template>

<template name="comment">
  <li class="comment-item">
    <div class="comment-tools hide">
      <a>删除</a>
      <a>回复</a>
    </div>
    <div class="row">
      <div class="span1">
        <img src="{{author.avatar}}" class="avatar-medium">
      </div>
      <div class="span7">
        <div class="author">
          <a href="#">{{author.username}}</a>
          <span class="pull-right">{{created}}</span>
        </div>
        <p>{{content}}</p>
      </div>
    </div>
  </li>
</template>